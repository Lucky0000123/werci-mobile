name: Test Build (WERCI Mobile)

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main

jobs:
  test-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Create test environment file
        run: |
          cat > .env << EOF
          VITE_CLOUD_BASE=http://159.65.13.232:8082
          VITE_LOCAL_BASE=http://10.40.21.184:8082
          VITE_DEV_BASE=http://localhost:8082
          VITE_DEBUG_MODE=true
          VITE_LOG_LEVEL=debug
          VITE_APP_NAME=WERCI Inspector
          VITE_APP_VERSION=1.0.0-test
          VITE_COMPANY_NAME=WERCI
          EOF

      - name: Run linting (warnings only)
        run: npm run lint --if-present || echo "âš ï¸ Linting completed with warnings"

      - name: Build web application
        run: npm run build

      - name: Test build artifacts
        run: |
          echo "âœ… Build completed successfully"
          ls -la dist/
          echo "ðŸ“¦ Build size:"
          du -sh dist/
